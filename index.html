<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cahiers des Charges</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function ProjectManager() {
      const [projects, setProjects] = useState([]);
      const [showForm, setShowForm] = useState(false);
      const [viewProject, setViewProject] = useState(null);
      const [editingProject, setEditingProject] = useState(null);
      const [darkMode, setDarkMode] = useState(true);

      const emptyForm = {
        clientName: "",
        clientEmail: "",
        projectName: "",
        projectType: "",
        language: "",
        priority: "Moyenne",
        status: "En attente",
        budget: "",
        deadline: "",
        description: "",
        features: "",
        technicalRequirements: "",
        notes: ""
      };

      const [formData, setFormData] = useState(emptyForm);

      useEffect(() => {
        const saved = localStorage.getItem("cdc-projects");
        const theme = localStorage.getItem("cdc-theme");
        if (saved) setProjects(JSON.parse(saved));
        if (theme) setDarkMode(theme === "dark");
      }, []);

      useEffect(() => {
        localStorage.setItem("cdc-projects", JSON.stringify(projects));
      }, [projects]);

      useEffect(() => {
        localStorage.setItem("cdc-theme", darkMode ? "dark" : "light");
      }, [darkMode]);

      const saveProject = () => {
        if (!formData.clientName || !formData.projectName || !formData.projectType || !formData.language || !formData.description) {
          alert("Veuillez remplir les champs obligatoires");
          return;
        }

        const project = {
          ...formData,
          id: editingProject ? editingProject.id : Date.now(),
          createdAt: editingProject ? editingProject.createdAt : new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };

        setProjects(editingProject
          ? projects.map(p => p.id === project.id ? project : p)
          : [...projects, project]
        );

        setFormData(emptyForm);
        setEditingProject(null);
        setShowForm(false);
      };

      const exportCDC = (p) => {
        const content = `
CAHIER DES CHARGES

Client : ${p.clientName}
Email : ${p.clientEmail}
Projet : ${p.projectName}
Type : ${p.projectType}
Langage : ${p.language}
Priorit√© : ${p.priority}
Statut : ${p.status}
Budget : ${p.budget}
Deadline : ${p.deadline}

DESCRIPTION
${p.description}

FONCTIONNALIT√âS
${p.features}

EXIGENCES TECHNIQUES
${p.technicalRequirements}

NOTES
${p.notes}
        `;

        const blob = new Blob([content], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `CDC_${p.projectName.replace(/\s+/g, "_")}.txt`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const bg = darkMode ? "bg-gray-900 text-white" : "bg-gray-100 text-gray-800";
      const card = darkMode ? "bg-gray-800" : "bg-white";

      return (
        <div className={`min-h-screen ${bg} p-4`}>
          <div className="max-w-5xl mx-auto">

            <div className="flex justify-between mb-6">
              <h1 className="text-3xl font-bold">Cahiers des Charges</h1>
              <button
                onClick={() => setDarkMode(!darkMode)}
                className="px-4 py-2 rounded bg-indigo-600 text-white"
              >
                {darkMode ? "‚òÄÔ∏è Clair" : "üåô Sombre"}
              </button>
            </div>

            {!showForm && !viewProject && (
              <>
                <button
                  onClick={() => setShowForm(true)}
                  className="mb-4 bg-green-600 text-white px-4 py-2 rounded"
                >
                  ‚ûï Nouveau projet
                </button>

                <div className="grid md:grid-cols-2 gap-4">
                  {projects.map(p => (
                    <div key={p.id} className={`${card} p-4 rounded`}>
                      <h3 className="font-bold">{p.projectName}</h3>
                      <p className="text-sm">{p.clientName}</p>

                      <div className="flex gap-2 mt-3">
                        <button onClick={() => setViewProject(p)} className="bg-indigo-600 text-white px-3 py-1 rounded">
                          Voir
                        </button>
                        <button onClick={() => { setEditingProject(p); setFormData(p); setShowForm(true); }} className="bg-yellow-500 px-3 py-1 rounded">
                          Modifier
                        </button>
                        <button onClick={() => setProjects(projects.filter(x => x.id !== p.id))} className="bg-red-600 text-white px-3 py-1 rounded">
                          Supprimer
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </>
            )}

            {viewProject && (
              <div className={`${card} p-4 rounded`}>
                <h2 className="text-2xl font-bold mb-2">{viewProject.projectName}</h2>
                <p><b>Client :</b> {viewProject.clientName}</p>
                <p><b>Description :</b></p>
                <pre className="whitespace-pre-wrap">{viewProject.description}</pre>

                <div className="flex gap-3 mt-4">
                  <button onClick={() => exportCDC(viewProject)} className="bg-indigo-600 text-white px-4 py-2 rounded">
                    üìÑ Exporter CDC
                  </button>
                  <button onClick={() => setViewProject(null)} className="bg-gray-500 text-white px-4 py-2 rounded">
                    Retour
                  </button>
                </div>
              </div>
            )}

            {showForm && (
              <div className={`${card} p-4 rounded`}>
                <h2 className="text-xl font-bold mb-3">{editingProject ? "Modifier" : "Nouveau"} projet</h2>

                {Object.keys(emptyForm).map(k => (
                  <div key={k} className="mb-2">
                    <input
                      placeholder={k}
                      value={formData[k]}
                      onChange={e => setFormData({...formData, [k]: e.target.value})}
                      className="w-full p-2 rounded text-black"
                    />
                  </div>
                ))}

                <div className="flex gap-3 mt-4">
                  <button onClick={saveProject} className="bg-green-600 text-white px-4 py-2 rounded">
                    üíæ Sauvegarder
                  </button>
                  <button onClick={() => setShowForm(false)} className="bg-gray-500 text-white px-4 py-2 rounded">
                    Annuler
                  </button>
                </div>
              </div>
            )}

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<ProjectManager />);
  </script>
</body>
</html>
