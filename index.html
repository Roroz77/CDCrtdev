<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cahier des Charges</title>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

function App() {
  const empty = {
    clientName: "",
    clientEmail: "",
    projectName: "",
    projectType: "",
    language: "",
    priority: "Moyenne",
    status: "En attente",
    budget: "",
    deadline: "",
    description: "",
    features: "",
    technical: "",
    notes: ""
  };

  const [projects, setProjects] = useState([]);
  const [form, setForm] = useState(empty);
  const [editing, setEditing] = useState(null);
  const [view, setView] = useState(null);
  const [dark, setDark] = useState(true);

  useEffect(() => {
    const p = localStorage.getItem("cdc");
    const t = localStorage.getItem("theme");
    if (p) setProjects(JSON.parse(p));
    if (t) setDark(t === "dark");
  }, []);

  useEffect(() => {
    localStorage.setItem("cdc", JSON.stringify(projects));
  }, [projects]);

  useEffect(() => {
    localStorage.setItem("theme", dark ? "dark" : "light");
  }, [dark]);

  const save = () => {
    if (!form.clientName || !form.projectName || !form.projectType || !form.description) {
      alert("Merci de remplir les champs obligatoires");
      return;
    }

    const obj = {
      ...form,
      id: editing ? editing.id : Date.now(),
      createdAt: editing ? editing.createdAt : new Date().toISOString()
    };

    setProjects(editing
      ? projects.map(p => p.id === obj.id ? obj : p)
      : [...projects, obj]
    );

    setForm(empty);
    setEditing(null);
  };

  const exportCDC = p => {
    const txt = `CAHIER DES CHARGES

CLIENT
${p.clientName}
${p.clientEmail}

PROJET
${p.projectName}
Type : ${p.projectType}
Technologie : ${p.language}

DESCRIPTION
${p.description}

FONCTIONNALIT√âS
${p.features}

EXIGENCES TECHNIQUES
${p.technical}

NOTES
${p.notes}
`;
    const b = new Blob([txt], { type: "text/plain" });
    const u = URL.createObjectURL(b);
    const a = document.createElement("a");
    a.href = u;
    a.download = `CDC_${p.projectName.replace(/\s+/g, "_")}.txt`;
    a.click();
    URL.revokeObjectURL(u);
  };

  const bg = dark ? "bg-gray-900 text-white" : "bg-gray-100 text-gray-900";
  const card = dark ? "bg-gray-800" : "bg-white";

  return (
    <div className={`min-h-screen ${bg}`}>
      <div className="max-w-xl mx-auto p-4">

        <header className="flex justify-between items-center mb-6">
          <h1 className="text-xl font-bold">Cahiers des Charges</h1>
          <button
            onClick={() => setDark(!dark)}
            className="px-3 py-2 rounded bg-indigo-600 text-white text-sm">
            {dark ? "‚òÄÔ∏è" : "üåô"}
          </button>
        </header>

        {!view && (
          <button
            onClick={() => { setForm(empty); setEditing(null); }}
            className="w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold mb-4">
            ‚ûï Nouveau projet
          </button>
        )}

        {!view && !editing && (
          <div className="space-y-3">
            {projects.map(p => (
              <div key={p.id} className={`${card} p-4 rounded-xl`}>
                <p className="font-semibold">{p.projectName}</p>
                <p className="text-sm opacity-70">{p.clientName}</p>

                <div className="flex gap-2 mt-3">
                  <button onClick={() => setView(p)} className="flex-1 bg-indigo-600 text-white py-2 rounded-lg">
                    Voir
                  </button>
                  <button onClick={() => { setForm(p); setEditing(p); }} className="flex-1 bg-yellow-500 py-2 rounded-lg">
                    Modifier
                  </button>
                </div>
              </div>
            ))}
          </div>
        )}

        {view && (
          <div className={`${card} p-4 rounded-xl space-y-3`}>
            <h2 className="text-lg font-bold">{view.projectName}</h2>
            <p><b>Client :</b> {view.clientName}</p>
            <p className="whitespace-pre-wrap">{view.description}</p>

            <button
              onClick={() => exportCDC(view)}
              className="w-full bg-green-600 text-white py-3 rounded-xl">
              üìÑ Exporter le CDC
            </button>

            <button
              onClick={() => setView(null)}
              className="w-full bg-gray-500 text-white py-2 rounded-xl">
              Retour
            </button>
          </div>
        )}

        {(editing !== null) && (
          <div className={`${card} p-4 rounded-xl space-y-4`}>
            <h2 className="text-lg font-bold">Informations du projet</h2>

            <input placeholder="Nom du client *" value={form.clientName}
              onChange={e => setForm({...form, clientName: e.target.value})}
              className="w-full p-3 rounded-lg text-black"/>

            <input placeholder="Email du client"
              value={form.clientEmail}
              onChange={e => setForm({...form, clientEmail: e.target.value})}
              className="w-full p-3 rounded-lg text-black"/>

            <input placeholder="Nom du projet *"
              value={form.projectName}
              onChange={e => setForm({...form, projectName: e.target.value})}
              className="w-full p-3 rounded-lg text-black"/>

            <input placeholder="Type de projet (site, app, bot...) *"
              value={form.projectType}
              onChange={e => setForm({...form, projectType: e.target.value})}
              className="w-full p-3 rounded-lg text-black"/>

            <textarea placeholder="Description du projet *"
              value={form.description}
              onChange={e => setForm({...form, description: e.target.value})}
              rows="4"
              className="w-full p-3 rounded-lg text-black"/>

            <textarea placeholder="Fonctionnalit√©s attendues"
              value={form.features}
              onChange={e => setForm({...form, features: e.target.value})}
              rows="3"
              className="w-full p-3 rounded-lg text-black"/>

            <textarea placeholder="Exigences techniques"
              value={form.technical}
              onChange={e => setForm({...form, technical: e.target.value})}
              rows="3"
              className="w-full p-3 rounded-lg text-black"/>

            <textarea placeholder="Notes"
              value={form.notes}
              onChange={e => setForm({...form, notes: e.target.value})}
              rows="2"
              className="w-full p-3 rounded-lg text-black"/>

            <button onClick={save} className="w-full bg-indigo-600 text-white py-3 rounded-xl">
              üíæ Enregistrer
            </button>
          </div>
        )}

      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
